<!-- SB Admin 2 Stock Prediction Dashboard -->

<!-- Service Status Row -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow" [ngClass]="{'border-left-success': isServiceOnline, 'border-left-danger': !isServiceOnline}">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-uppercase mb-1" 
                 [ngClass]="{'text-success': isServiceOnline, 'text-danger': !isServiceOnline}">
              ML Service Status
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">
              {{ isServiceOnline ? 'Online & Operational' : 'Offline' }}
            </div>
            <div class="text-muted small mt-1">Real-time prediction engine status</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-2x text-gray-300" 
               [ngClass]="{'fa-check-circle text-success': isServiceOnline, 'fa-times-circle text-danger': !isServiceOnline}"></i>
          </div>
        </div>
        
        <!-- Service Stats -->
        <div class="row mt-3" *ngIf="serviceStats && isServiceOnline">
          <div class="col-md-3 col-6 text-center">
            <div class="h6 mb-0 font-weight-bold text-primary">{{ serviceStats.uptime || '99.9%' }}</div>
            <div class="text-muted small">Uptime</div>
          </div>
          <div class="col-md-3 col-6 text-center">
            <div class="h6 mb-0 font-weight-bold text-success">{{ serviceStats.cache_hit_rate || '85' }}%</div>
            <div class="text-muted small">Cache Hit</div>
          </div>
          <div class="col-md-3 col-6 text-center">
            <div class="h6 mb-0 font-weight-bold text-info">{{ serviceStats.response_time || '<2s' }}</div>
            <div class="text-muted small">Response</div>
          </div>
          <div class="col-md-3 col-6 text-center">
            <div class="h6 mb-0 font-weight-bold text-warning">{{ serviceStats.predictions_today || '127' }}</div>
            <div class="text-muted small">Predictions</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Stats Row -->
<div class="row mb-4">
  
  <!-- Total Predictions Card -->
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-primary shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
              Total Predictions
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ totalPredictions || '1,247' }}</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-chart-line fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Accuracy Rate Card -->
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-success shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
              Accuracy Rate
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ accuracyRate || '87.5' }}%</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-bullseye fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Active Models Card -->
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-info shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
              Active Models
            </div>
            <div class="row no-gutters align-items-center">
              <div class="col-auto">
                <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{ activeModels || '13' }}</div>
              </div>
              <div class="col">
                <div class="progress progress-sm mr-2">
                  <div class="progress-bar bg-info" role="progressbar" 
                       style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-auto">
            <i class="fas fa-brain fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Avg Confidence Card -->
  <div class="col-xl-3 col-md-6 mb-4">
    <div class="card border-left-warning shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
              Avg Confidence
            </div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ avgConfidence || '82.3' }}%</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-percentage fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
</div>

<!-- Stock Input and Quick Select Row -->
<div class="row mb-4">
  
  <!-- Stock Symbol Input Card -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="fas fa-search mr-2"></i>Stock Symbol Lookup
        </h6>
      </div>
      <div class="card-body">
        <div class="form-group">
          <label for="stockSymbol" class="form-label font-weight-bold">Enter Stock Symbol</label>
          <div class="input-group">
            <input 
              type="text" 
              id="stockSymbol"
              class="form-control form-control-lg"
              [(ngModel)]="stockSymbol" 
              (keyup.enter)="getPrediction()"
              placeholder="e.g., NVDA, TSLA, AAPL"
              [disabled]="isLoading">
            <div class="input-group-append">
              <button 
                class="btn btn-primary btn-lg" 
                type="button" 
                (click)="getPrediction()"
                [disabled]="isLoading || !stockSymbol.trim()">
                <i class="fas fa-chart-line mr-1" *ngIf="!isLoading"></i>
                <i class="fas fa-spinner fa-spin mr-1" *ngIf="isLoading"></i>
                {{ isLoading ? 'Analyzing...' : 'Predict' }}
              </button>
            </div>
          </div>
          <small class="form-text text-muted">
            Enter any US stock symbol for AI-powered price prediction
          </small>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Quick Select Stocks Card -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="fas fa-star mr-2"></i>Popular Stocks
        </h6>
      </div>
      <div class="card-body">
        <p class="text-muted mb-3">Quick access to trending stocks</p>
        <div class="row">
          <div class="col-6 col-md-4 mb-2" *ngFor="let symbol of popularStocks">
            <button 
              class="btn btn-outline-primary btn-sm btn-block"
              (click)="selectStock(symbol)"
              [disabled]="isLoading">
              {{ symbol }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
</div>

<!-- Prediction Result Card -->
<div class="row mb-4" *ngIf="predictionResult">
  <div class="col-12">
    <div class="card shadow border-left-primary">
      <div class="card-header py-3 bg-gradient-primary text-white">
        <h6 class="m-0 font-weight-bold">
          <i class="fas fa-chart-area mr-2"></i>
          Prediction Result for {{ predictionResult.symbol }}
        </h6>
      </div>
      <div class="card-body">
        <div class="row">
          
          <!-- Current Price -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">Current Price</div>
              <div class="h4 mb-0 font-weight-bold text-dark">
                ${{ predictionResult.current_price | number:'1.2-2' }}
              </div>
            </div>
          </div>
          
          <!-- Predicted Price -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">Predicted Price</div>
              <div class="h4 mb-0 font-weight-bold text-primary">
                ${{ predictionResult.predicted_price | number:'1.2-2' }}
              </div>
            </div>
          </div>
          
          <!-- Trading Signal -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">Trading Signal</div>
              <span class="badge badge-lg font-weight-bold" 
                    [ngClass]="getTradingSignalClass(predictionResult.trading_signal)">
                {{ predictionResult.trading_signal }}
              </span>
            </div>
          </div>
          
          <!-- Confidence -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="text-center p-3 bg-light rounded">
              <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">Confidence</div>
              <div class="h4 mb-0 font-weight-bold" 
                   [ngClass]="getConfidenceClass(predictionResult.confidence)">
                {{ (predictionResult.confidence * 100) | number:'1.1-1' }}%
              </div>
              <div class="progress mt-2" style="height: 6px;">
                <div class="progress-bar" 
                     [ngClass]="getConfidenceProgressClass(predictionResult.confidence)"
                     role="progressbar" 
                     [style.width.%]="predictionResult.confidence * 100"
                     [attr.aria-valuenow]="predictionResult.confidence * 100" 
                     aria-valuemin="0" 
                     aria-valuemax="100">
                </div>
              </div>
            </div>
          </div>
          
        </div>
        
        <!-- Price Change Indicator -->
        <div class="row mt-3">
          <div class="col-12">
            <div class="alert" [ngClass]="getPriceChangeAlertClass()" role="alert">
              <div class="d-flex align-items-center">
                <i class="fas mr-2" [ngClass]="getPriceChangeIcon()"></i>
                <div>
                  <strong>{{ getPriceChangeText() }}</strong>
                  <div class="small">
                    {{ getPriceChangeDescription() }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Prediction Metadata -->
        <div class="row mt-3">
          <div class="col-md-6">
            <small class="text-muted">
              <i class="fas fa-clock mr-1"></i>
              Prediction Time: {{ predictionResult.prediction_time | date:'medium' }}
            </small>
          </div>
          <div class="col-md-6 text-md-right">
            <small class="text-muted">
              <i class="fas fa-microchip mr-1"></i>
              Model Version: {{ predictionResult.model_version }}
            </small>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<!-- Historical Data Card -->
<div class="row mb-4" *ngIf="historicalData && historicalData.length > 0">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
          <i class="fas fa-history mr-2"></i>
          Historical Data for {{ predictionResult?.symbol }}
        </h6>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-hover" width="100%" cellspacing="0">
            <thead class="thead-light">
              <tr>
                <th>Date</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Close</th>
                <th>Volume</th>
                <th>Change</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of historicalData.slice(0, 10)">
                <td class="font-weight-bold">{{ data.date | date:'shortDate' }}</td>
                <td>${{ data.open | number:'1.2-2' }}</td>
                <td class="text-success">${{ data.high | number:'1.2-2' }}</td>
                <td class="text-danger">${{ data.low | number:'1.2-2' }}</td>
                <td class="font-weight-bold">${{ data.close | number:'1.2-2' }}</td>
                <td>{{ data.volume | number }}</td>
                <td [ngClass]="getChangeClass(data.change)">
                  <i class="fas" [ngClass]="getChangeIcon(data.change)"></i>
                  {{ data.change | number:'1.2-2' }}%
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="text-center mt-3" *ngIf="historicalData.length > 10">
          <button class="btn btn-outline-primary btn-sm" (click)="showMoreHistoricalData()">
            <i class="fas fa-chevron-down mr-1"></i>
            Show More Data
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error Alert -->
<div class="row" *ngIf="errorMessage">
  <div class="col-12">
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="fas fa-exclamation-triangle mr-2"></i>
      <strong>Error:</strong> {{ errorMessage }}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close" (click)="clearError()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="row" *ngIf="isLoading">
  <div class="col-12">
    <div class="card shadow">
      <div class="card-body text-center py-5">
        <div class="loading-spinner mb-3"></div>
        <h5 class="text-muted">Analyzing Market Data...</h5>
        <p class="text-muted mb-0">Our AI models are processing the latest market information</p>
      </div>
    </div>
  </div>
</div>
